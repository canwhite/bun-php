# Task: 重写 API 测试页面，避免类型问题

**任务ID**: task_rewrite_api_test_260124_094000
**创建时间**: 2026-01-24
**状态**: 进行中
**目标**: 重写 api-test/page.tsx，设计类型安全的组件，避免 ESLint 和 TypeScript 类型问题

## 最终目标

1. 重新设计 API 测试页面，解决现有的类型安全问题
2. 创建类型安全的组件结构，避免 `any` 类型和未定义变量
3. 改进代码架构，分离服务端和客户端逻辑
4. 通过所有 ESLint 和 TypeScript 检查

## 拆解步骤

### 1. 分析当前类型问题并设计解决方案

- [ ] 分析当前 ESLint 和类型检查错误
- [ ] 设计类型安全的 API 响应类型
- [ ] 设计清晰的组件架构（分离服务端/客户端逻辑）

### 2. 实现类型安全的 API 测试页面

- [ ] 创建明确的类型定义
- [ ] 实现服务端数据获取函数（类型安全）
- [ ] 实现客户端测试功能（类型安全）
- [ ] 设计清晰的 UI 组件

### 3. 验证类型检查和功能

- [ ] 运行 TypeScript 类型检查验证
- [ ] 运行 ESLint 检查验证
- [ ] 测试组件功能（服务端和客户端调用）

## 当前进度

### 已完成: 步骤1 - 分析当前类型问题并设计解决方案

已识别的主要问题：

1. **ESLint 错误**:
   - `fetch` 未定义（需要在全局声明）
   - 未使用的状态变量：`setServerApiResult`, `clientApiResult`, `isLoading`, `testClientApi`
   - 未转义的 HTML 字符（单引号）

2. **类型问题**:
   - 使用 `any` 类型
   - 服务端渲染逻辑混乱（状态管理不正确）

3. **架构问题**:
   - 服务端调用写在组件渲染中，导致重复执行
   - 状态管理不清晰

设计目标：
- 使用明确的接口类型替代 `any`
- 正确声明全局 `fetch`
- 简化状态管理，移除未使用的状态
- 分离服务端和客户端逻辑

### 已完成: 步骤2 - 实现类型安全的 API 测试页面

已实现的新组件特性：

1. **明确的类型定义**:
   - `HelloApiResponse` - API 响应数据结构
   - `ApiTestResult` - 测试结果类型（包含成功/失败、耗时等）
   - `ClientTestState` - 客户端测试状态类型

2. **类型安全的 API 调用函数**:
   - `callApiFromServer()` - 服务端调用（使用绝对地址）
   - `callApiFromClient()` - 客户端调用（使用相对路径）
   - 两个函数都返回强类型的 `ApiTestResult`

3. **清晰的组件结构**:
   - 分离服务端和客户端逻辑
   - 简化的状态管理（只有客户端测试状态）
   - 可重用的结果渲染组件

4. **ESLint 问题修复**:
   - 添加了 `/* global fetch */` 声明
   - 转义了所有 HTML 字符（使用 `&apos;`）
   - 移除了所有未使用的变量

### 正在进行: 步骤3 - 验证类型检查和功能

开始验证实现是否解决了所有类型问题。