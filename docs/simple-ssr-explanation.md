# 给小白看的服务端渲染解释

## 问题：服务端界面能加按钮吗？

**简单回答**：能！但是需要了解一点原理。

## 核心概念（用餐厅比喻）

### 1. 服务端 = 厨房
- 在**厨房**（服务端）里把菜做好
- 顾客**立即**能看到菜（页面内容）
- 但菜还是**热的**，不能马上吃（按钮不能点）

### 2. 客户端 = 餐桌
- 菜端到**餐桌**（客户端/浏览器）
- 服务员给你**餐具**（JavaScript文件）
- 现在你可以**开吃**了（按钮可以点了）

## 代码为什么会执行两次？

### 第一次：在厨房做菜（服务端）
```
厨房收到订单 → 厨师做菜 → 菜做好放在盘子里
```
- 生成**静态HTML**（就像把菜摆好盘）
- 这时候按钮**只是图片**（不能点击）

### 第二次：在餐桌吃饭（客户端）
```
菜端上桌 → 你拿到餐具 → 开始吃饭
```
- 浏览器**激活**页面
- 给按钮**绑定点击事件**
- 按钮**可以点击**了

## `window` 是什么？为什么要判断？

### `window` = 浏览器窗口
- 就像**餐厅的窗户**，厨房里没有窗户
- **厨房**（服务端）里问"窗户外面天气如何？" → 没有答案（报错）
- **餐桌**（客户端）问"窗户外面天气如何？" → 能看到天气（正常工作）

### 代码示例（简单版）

```javascript
// ❌ 错误写法（在厨房问窗户）
function 显示天气() {
  const 天气 = window.外面天气; // 厨房里没有窗户，会报错！
  return `今天天气：${天气}`;
}

// ✅ 正确写法（先看看在哪）
function 显示天气() {
  let 天气 = "未知";

  // 先看看自己是不是在餐厅里（有窗户）
  if (typeof window !== 'undefined') {
    天气 = window.外面天气; // 只有餐厅里才能看窗户
  }

  return `今天天气：${天气}`;
}
```

## 点击事件怎么工作？

### 在厨房（服务端）：
```javascript
// 厨师写下菜单："这个按钮可以点击"
<button onclick="厨师说点击我()">点击我</button>
// 但菜还没端上桌，所以暂时不能点
```

### 在餐桌（客户端）：
```javascript
// 你拿到餐具后，真的可以点击了
按钮.添加点击事件(() => {
  alert('你真的点到了！');
});
```

## 你的项目中的实际例子

### 文件：`src/app/api-test/page.tsx`

这个文件做了两件事：

1. **在厨房做事**（服务端）：
```javascript
if (typeof window === 'undefined') {
  // 厨房里：准备数据，但不管窗户
  获取数据().then(结果 => {
    记录日志('厨房准备好了数据');
  });
}
```

2. **在餐桌做事**（客户端）：
```javascript
const 测试按钮点击 = async () => {
  // 餐桌上：可以看窗户，可以用餐具
  const 开始时间 = Date.now();
  // 点击按钮后执行这里
};
```

## 简单记忆要点

### 1. 两个地方执行
- **服务端**：厨房，没有窗户（`window`）
- **客户端**：餐桌，有窗户（`window`）

### 2. 按钮的两个阶段
- **阶段1**：厨房摆盘（显示按钮，但不能点）
- **阶段2**：餐桌用餐（可以点击按钮）

### 3. `window` 判断
```javascript
if (有窗户吗？) {
  // 在餐厅，可以看窗外
  看看天气();
} else {
  // 在厨房，专心做菜
  继续做菜();
}
```

### 4. 点击事件
- 写在**菜单**上（代码里）
- 但只在**餐桌上**生效（客户端）

## 常见问题

### Q：为什么这么麻烦？直接做能点的按钮不行吗？
**A**：为了**更快显示页面**。如果等所有东西都准备好再显示，用户要等更久。

### Q：我怎么知道代码在哪里执行？
**A**：记住这个：
- 如果用了 `window`、`document`、`alert` → 只能在客户端用
- 如果要做数据库查询、文件读取 → 在服务端做

### Q：写代码要注意什么？
**A**：加个判断：
```javascript
if (typeof window !== 'undefined') {
  // 这里可以用 window 相关的东西
} else {
  // 这里不能用 window
}
```

## 实际项目中的应用

在你的 `bun-php` 项目中：

### 1. 普通页面（服务端组件）
```javascript
// 展示内容，简单交互
// 整个页面都会"激活"
```

### 2. 岛组件（特殊交互组件）
```javascript
// 复杂交互，比如计数器、表单
// 只有这个组件单独"激活"
// 性能更好
```

## 总结一句话

**服务端生成页面内容，客户端让它能交互，中间用 `window` 判断区分环境。**

---

### 更简单的理解
想象你在网上订外卖：

1. **餐厅**（服务端）做好饭 → **立即**显示订单详情（页面内容）
2. **外卖员**（客户端）送到你家 → 给你**餐具**（JavaScript）
3. 你现在可以**吃饭**了（交互）

没有餐具（JavaScript），你只能看饭不能吃（页面只能看不能点）。

---

**文档创建时间**：2026年1月24日
**适合人群**：刚接触服务端渲染的小白
**项目**：bun-php (Bun + Hono + Preact)
**建议**：先理解概念，再慢慢看代码